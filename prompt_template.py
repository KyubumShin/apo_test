# prompt_template.py
"""
APO 프로젝트의 공통 프롬프트 템플릿을 정의합니다.
모든 프롬프트는 여기서 관리하고, 필요한 곳에서 import하여 사용합니다.
"""

# =============================================================================
# 카테고리 정의 (분류 태스크용)
# =============================================================================
CATEGORY_DEFINITIONS = """카테고리 정의:
- 주행: 주행 및 내비게이션 관련 요청
- 차량 상태: 차량 진단/상태 확인
- 차량 제어: 차량 기능 조작 요청
- 미디어: 음악/라디오, 엔터테인먼트 요청
- 개인 비서: 전화, 메시지, 일정 등 개인 비서 기능 요청"""

# =============================================================================
# 출력 형식 지침
# =============================================================================
OUTPUT_FORMAT_INSTRUCTION = """출력 포맷:
list 형태로 응답합니다. 해당되는 카테고리가 없다면 빈 배열로 응답하세요. 배열 내 문자열은 작은 따옴표로 감싸세요."""

# =============================================================================
# 분류기 시스템 프롬프트 (rollout.py, train_apo.py 공통)
# =============================================================================
CLASSIFICATION_SYSTEM_PROMPT = f"""당신은 분류기입니다.
입력 문장을 아래 5개 카테고리 중 해당되는 항목으로 분류하세요.

{CATEGORY_DEFINITIONS}

{OUTPUT_FORMAT_INSTRUCTION}
"""

# =============================================================================
# LLM Judge 프롬프트 템플릿 (rollout.py)
# =============================================================================
JUDGE_PROMPT_TEMPLATE = """당신은 분류 결과를 평가하는 엄격한 심사관입니다.

입력 문장: {question}
예상 정답: {expected_labels}
모델 출력: {predicted}

평가 기준:
1. 출력이 유효한 리스트 형식인지 확인
2. 예상 정답과 모델 출력의 카테고리가 일치하는지 확인
3. 완전 일치: 1.0점, 부분 일치: 0.3~0.7점, 불일치: 0.0점
4. 형식이 잘못되었더라도 내용이 맞으면 감점 후 점수 부여

반드시 JSON 형식으로 응답하세요:
{{"reason": "점수 부여 이유", "score": 0.0에서 1.0 사이의 숫자}}"""

# =============================================================================
# Text Gradient 분석 지침 (text_gradient_ko.poml용)
# =============================================================================
TEXT_GRADIENT_ANALYSIS_GUIDELINES = """보상이 1.0 미만인 실험들을 분석하여 문제 패턴을 찾으십시오.    
보상 점수의 의미:
- 0.0~0.5: 리스트 형태로 파싱할 수 없거나, 파싱되더라도 정답과의 교집합이 전혀 없는 경우
- 0.5~0.9: 레이블이 완전히 같지는 않지만 문자열이 부분적으로 겹치는 경우. 또는 여러 레이블 중 일부만 맞힌 경우
- 0.9 이상: 내용(레이블 집합)이 완전히 동일하지만, 따옴표, 공백, 대소문자 등의 형식이 다른 경우"""

# =============================================================================
# 헬퍼 함수
# =============================================================================
def format_judge_prompt(question: str, expected_labels: list, predicted: str) -> str:
    """Judge 프롬프트를 포맷팅합니다."""
    return JUDGE_PROMPT_TEMPLATE.format(
        question=question,
        expected_labels=expected_labels,
        predicted=predicted
    )
